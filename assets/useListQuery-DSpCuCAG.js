import{R as m,j as c,P as x,S as f,B as h,v as S,x as y,z as g,F as j,G as F,H as A}from"./index-BnIdKn0F.js";import{C as w}from"./Close-C_r9NWc7.js";import{u as B,h as E}from"./FilterField-D-Ydp0Gj.js";import{C as P}from"./DataGrid-B-yQAN5I.js";import{u as b}from"./useQuery-D8D7mxBQ.js";const z=({header:e="Filters",grouped:i=!0,onChange:o,onClose:n,config:u,children:r,...l})=>{const{activeFilters:t,dispatch:s}=B();let a=0;m.Children.forEach(r,p=>{if(m.isValidElement(p)&&p.props.field&&E(t.find(v=>v.field===p.props.field)))return a++});const d=()=>{s({type:"SET_ACTIVE_FILTERS",payload:[]})};return c.jsx(x,{elevation:0,variant:"outlined",...l,children:c.jsxs(f,{spacing:0,children:[e&&c.jsxs(f,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[c.jsxs(f,{direction:"row",spacing:2,flex:1,children:[c.jsx(h,{children:e}),a>0&&c.jsx(P,{label:`${a} active`,color:"primary",size:"small"})]}),c.jsx(S,{variant:"outlined",onClick:d,sx:{marginRight:1},children:"Reset"}),c.jsx(y,{onClick:n,children:c.jsx(w,{})})]}),i&&c.jsx(f,{spacing:0,children:r}),!i&&c.jsx(f,{spacing:2,sx:{padding:2},children:r})]})})},k=(e,i,o)=>{let n=e;return i&&(n=e.filter(u=>{if(!o||o==="all")return JSON.stringify(u).toLowerCase().indexOf(i.toLowerCase())>-1;{const r=u[o];return r!=null?String(r).toLowerCase().indexOf(i.toLowerCase())>-1:!1}})),n},R=(e,i,o)=>{let n=e;if(e&&i.length>0){const u={};i.forEach(r=>{if(o){const l=o.find(t=>t.field===r.field);u[r.field]=l==null?void 0:l.operator}}),n=e.filter(r=>{let l=!0;return i.forEach(t=>{let s=!1;if(l===!0)switch(u[t.field]){case"contains":{r[t.field].indexOf(t.value)>-1&&(s=!0);break}case"contains-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||(Array.isArray(r[t.field])?r[t.field].indexOf(a)>-1&&(s=!0):r[t.field]===a&&(s=!0))});break}case"equals-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||r[t.field]===a&&(s=!0)});break}case"between-inclusive":{if(Array.isArray(t.value)){const a=t.value[0],d=t.value[1];r[t.field]>=a&&r[t.field]<=d&&(s=!0)}break}case"between-dates-inclusive":{if(typeof r[t.field]=="string"&&Array.isArray(t.value)&&t.value[0]&&t.value[1]){const a=g(r[t.field]);a.isAfter(t.value[0])&&a.isBefore(t.value[1])&&(s=!0)}else s=!0;break}}s||(l=!1)}),l})}return n},I=(e,i,o,n,u)=>{const r=k(e,n,u);return R(r,i,o)},V=e=>{let i=e.queryMode==="server"?j(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(s=>{e.staticParams&&i.append(s,e.staticParams[s].toString())}),e.queryMode==="server"&&(i.append("limit",e.pageSize.toString()),i.append("offset",e.offset.toString()));const o=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:n,isFetching:u,isError:r,data:l,error:t}=b({queryKey:o,queryFn:async()=>{const s=i.toString();let a=e.dataSource;return s&&s.length>0&&(a=`${e.dataSource}?${s}`),await A(a)},placeholderData:F});return{isPending:n,isFetching:u,isError:r,data:l,error:t}};export{z as F,I as f,V as u};
